# Mag 数据录入完整指南

## 📝 三种录入方式对比

| 方式 | 适用场景 | 优点 | 缺点 |
|------|---------|------|------|
| **手动录入** | 少量数据，实时录入 | 交互式，有提示，不易出错 | 需要终端交互，逐条录入 |
| **快捷录入** | Claude Code环境 | 编辑脚本即可，适合AI辅助 | 需要编辑代码 |
| **批量导入** | 大量历史数据 | 一次导入多条，支持CSV/JSON/HTML | 需要准备数据文件 |

---

## 方式一：标准手动录入（推荐在终端使用）

### 启动程序
```bash
python3 mag_import.py manual
```

### 交互式录入流程

```
╭──────────────────────╮
│ Mag 手动录入工具     │
│ 请按提示输入币种数据 │
╰──────────────────────╯

日期 (格式: 2025-10-14) (2025-10-16): 2025-10-02
币种名称 (如: BTC): BTC
场外指数: 1164
爆破指数: 235
进退场期类型 (进场期/退场期): 进场期
进退场期天数: 1
谢林点 (可选，直接回车跳过):
是否为龙头币? (y/n，默认n): n
是否为美股? (y/n，默认n): n

✓ 数据录入成功: 2025-10-02 - BTC

是否继续录入? (y/n): y
```

### 字段说明

| 字段 | 说明 | 示例 | 是否必填 |
|------|------|------|---------|
| 日期 | 格式: YYYY-MM-DD | 2025-10-02 | ✅ |
| 币种名称 | 币种代号，大小写均可 | BTC, ETH, BNB | ✅ |
| 场外指数 | 整数 | 1164 | ✅ |
| 爆破指数 | 整数（可为负） | 235, -20 | ✅ |
| 进退场期类型 | 进场期 或 退场期 | 进场期 | ✅ |
| 进退场期天数 | 整数，第几天 | 1 | ✅ |
| 谢林点 | 浮点数，可选 | 110000 | ❌ |
| 是否为龙头币 | y/n | n | ❌ |
| 是否为美股 | y/n | n | ❌ |

---

## 方式二：快捷录入（推荐在Claude Code中使用）

### 步骤1: 编辑 quick_import.py

```python
data_to_import = [
    {
        'date': '2025-10-03',
        'coin': 'BTC',
        'phase_type': '进场期',
        'phase_days': 2,
        'offchain_index': 1180,
        'break_index': 240,
        'shelin_point': None,      # 可选
        'is_dragon_leader': 0,     # 1=龙头币，0=非龙头币
        'is_us_stock': 0           # 1=美股，0=非美股
    },
    {
        'date': '2025-10-03',
        'coin': 'ETH',
        'phase_type': '进场期',
        'phase_days': 2,
        'offchain_index': 1070,
        'break_index': 185,
        'shelin_point': 3850,
        'is_dragon_leader': 1,
        'is_us_stock': 0
    },
    # 继续添加...
]
```

### 步骤2: 运行脚本

```bash
python3 quick_import.py
```

### 输出示例

```
═══════════════════════════════════════════
  Mag 快捷录入工具
═══════════════════════════════════════════

                    待录入数据
┏━━━━━━━━━━━━┳━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┓
┃ 日期       ┃ 币种 ┃ 相位        ┃ 场外指数 ┃ 爆破指数 ┃
┡━━━━━━━━━━━━╇━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━┩
│ 2025-10-03 │ BTC  │ 进场期第2天 │     1180 │      240 │
│ 2025-10-03 │ ETH  │ 进场期第2天 │     1070 │      185 │
└────────────┴──────┴─────────────┴──────────┴──────────┘

✓ 已录入: 2025-10-03 - BTC
✓ 已录入: 2025-10-03 - ETH

录入完成！ 成功录入 2 条数据
```

---

## 方式三：批量导入

### CSV批量导入

#### 1. 生成CSV模板
```bash
python3 mag_import.py template csv
```

这会生成 `mag_import_template.csv` 文件。

#### 2. 编辑CSV文件

```csv
date,coin,phase_type,phase_days,offchain_index,break_index,shelin_point,is_dragon_leader,is_us_stock
2025-10-14,BTC,进场期,1,1050,200,110000,0,0
2025-10-14,ETH,进场期,1,980,180,3900,1,0
2025-10-14,BNB,进场期,1,1004,131,1140,0,0
```

#### 3. 导入数据
```bash
python3 mag_import.py csv mag_import_template.csv
```

### JSON批量导入

#### 1. 生成JSON模板
```bash
python3 mag_import.py template json
```

#### 2. 编辑JSON文件

```json
[
  {
    "date": "2025-10-14",
    "coin": "BTC",
    "phase_type": "进场期",
    "phase_days": 1,
    "offchain_index": 1050,
    "break_index": 200,
    "shelin_point": 110000,
    "is_dragon_leader": 0,
    "is_us_stock": 0
  }
]
```

#### 3. 导入数据
```bash
python3 mag_import.py json mag_import_template.json
```

### HTML导入（浮墨笔记）

直接导入浮墨笔记导出的HTML文件：

```bash
python3 mag_import.py html flow的笔记.html
```

系统会自动识别包含 `#Mag` 标签的笔记并解析数据。

---

## 📋 录入后的操作

### 1. 查看已录入数据

```bash
# 查看最新10条数据
sqlite3 mag_data.db "SELECT date, coin, offchain_index, break_index, phase_type FROM coin_daily_data ORDER BY date DESC LIMIT 10"
```

### 2. 分析录入的数据

#### 方式A: 分析最新日期
```bash
python3 mag_system.py
```

#### 方式B: 分析指定日期
```bash
python3 mag_reanalyze.py 2025-10-02
```

#### 方式C: 分析日期范围
```bash
python3 mag_reanalyze.py 2025-10-01 2025-10-05
```

---

## 🔄 补录数据后的处理

如果你补录了历史数据（比如遗漏的某天），需要重新分析：

### 场景1: 补录单个日期
```bash
# 1. 录入数据（任选一种方式）
python3 quick_import.py

# 2. 重新分析该日期
python3 mag_reanalyze.py 2025-10-02
```

### 场景2: 补录多个日期
```bash
# 1. 批量导入
python3 mag_import.py csv补录数据.csv

# 2. 重新分析整个日期范围
python3 mag_reanalyze.py 2025-10-01 2025-10-10
```

---

## ⚠️ 常见问题

### Q1: 手动录入时提示 "EOF when reading a line"
**原因**: 在非交互式终端（如Claude Code后台）运行了 `mag_import.py manual`
**解决**: 使用 `quick_import.py` 或批量导入方式

### Q2: 录入后分析显示"未检测到关键节点"
**原因**: 缺少历史参考数据，无法计算涨幅
**解决**: 补录更多历史数据，或等待后续数据积累

### Q3: 同一天同一币种录入两次会怎样？
**答**: 后一次会覆盖前一次（数据库主键是 date+coin）

### Q4: 如何删除错误的数据？
```bash
sqlite3 mag_data.db "DELETE FROM coin_daily_data WHERE date='2025-10-02' AND coin='BTC'"
```

---

## 💡 最佳实践

### ✅ 推荐做法

1. **每日录入**: 养成每天固定时间录入的习惯
2. **使用快捷录入**: 在Claude Code中直接编辑 `quick_import.py` 最方便
3. **录入后立即分析**: 确认数据正确性
4. **定期备份**: `cp mag_data.db mag_data_backup_$(date +%Y%m%d).db`

### ❌ 避免的做法

1. 不要跳过太多日期（会影响关键节点检测）
2. 不要在录入时混淆"进场期"和"退场期"
3. 不要忘记标记龙头币（会影响对标链验证）

---

## 📞 需要帮助？

- 查看主文档: `cat README.md`
- 查看更新日志: `cat CHANGELOG.md`
- 查看所有导入选项: `python3 mag_import.py`
